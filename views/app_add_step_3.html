<% include common/head.html %>

<!-- Side bar -->

<% include common/app_add_sidebar.html %>
<script src="/javascripts/sw/sw.app.js"></script>
<script type="text/javascript">
    <%
    if (appId != '0') { %>

        $(function () {
            smart.doget('/app/info.json?app_id=<%=appId%>', function (err, data) {
                console.log(data);
                $("#name").val(data.name);
                $("#version").val(data.version);
                $("#memo").val(data.memo);
                $("#description").val(data.description);
                for(var i = 1 ;i <= 5;i++){
                    if(data.editstep >= i  )
                        $("#step"+(i)+"").attr("href","/app/add/step"+(i)+"?appId="+data._id);
                    else
                        $("#step"+(i)+"").attr("href","#");
                }
            });
        });

    <%
    }
    %>
    function didSendStepCallback(result){
        console.log("console.log(result);");
        console.log(result);
        var appId = result.data._id;
        console.log("appp id   is   %s",appId);
        window.location.href = "/app/add/step4?appId="+appId;
    };
    function didSendFn(data){
        var sendData = {};
        var crsf = $("#_csrf").val();
        for (var i in data) {
            sendData[data[i].name] = data[i].value;
            if(data[i].name == 'appId'){
                sendData["_id"] = data[i].value;
            }
        }
        sendData["_csrf"] = crsf;
        console.log(sendData);
        return sendData;
    };

</script>


<div class="span9">

    <form class="required-validate form-horizontal" action="/app/create/step3.json" method="post"
          onsubmit="return validateCallback(this,didSendStepCallback,didSendFn,'确认提交吗？')">
        <input name="appId" value="<%=appId%>"/>

        <div class="widget-box">
            <div class="widget-title"><span class="icon"> <i class="icon-info-sign"></i> </span>
                <h5>权限管理</h5>
            </div>
            <div class="widget-content nopadding">

                <div class="control-group">
                    <label class="control-label">管理者</label>

                    <div class="controls">
                        <input type="hidden" name="permission.admin" id="permission_admin_input"/>

                        <div class="user_select_print">
                            <ul id="admin_user_selected">
                                <li>请设定管理者</li>
                            </ul>
                        </div>


                        <div style="margin-left: 15px" id="admin_set_btn" action="/user/list.json" data="{ }"
                             for="required"
                             generated="true"
                             class="help-inline setUserList" href="#document-selector" data-toggle="modal">设定
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">编辑者</label>

                    <div class="controls">
                        <input type="hidden" name="permission.edit" id="permission_edit_input"/>

                        <div class="user_select_print">
                            <ul id="edit_user_selected">
                                <li>请设定编辑者</li>
                            </ul>
                        </div>


                        <div style="margin-left: 15px" id="edit_set_btn" action="/user/list.json" data="{ }"
                             for="required"
                             generated="true"
                             class="help-inline setUserList" data="{sds:323,dfdf:343}" href="#document-selector"
                             data-toggle="modal">设定
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">阅览者</label>

                    <div class="controls">
                        <input type="hidden" name="permission.view" id="permission_view_input"/>

                        <div class="user_select_print">
                            <ul id="view_user_selected">
                                <li>请设定阅览者</li>
                            </ul>
                        </div>


                        <div style="margin-left: 15px"
                             id="view_set_btn"
                             taget="dialogAjax"
                             action="/user/list.json"
                             render="$app.didAdminSelectRender"
                             callback="$app.didAdminSelectCallback"
                             for="required"
                             generated="true"
                             class="help-inline setUserList"
                             href="#document-selector"
                             data-toggle="modal">设定
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">下载者</label>

                    <div class="controls">
                        <input type="hidden" name="permission.download" id="permission_download_input"/>

                        <div class="user_select_print">
                            <ul id="download_user_selected">
                                <li>下载者</li>
                            </ul>
                        </div>


                        <div style="margin-left: 15px" id="download_set_btn" action="/user/list.json" data="{ }"
                             for="required"
                             generated="true"
                             class="help-inline setUserList" href="#document-selector" data-toggle="modal">设定
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label"></label>

                    <div class="controls">
                        <button class="btn btn-small btn-success" type="submit">登录</button>
                        <button class="btn btn-small" type="">取消</button>
                    </div>
                </div>

            </div>
        </div>
    </form>
</div>


<!-- This is just a little bit of custom CSS code to enhance things. Feel free to place this in your main CSS file. I've commented to say what each bit does. -->
<style type="text/css">
        /* Removes the default 20px margin and creates some padding space for the indicators and controls */
    .carousel {
        margin-bottom: 0;
        padding: 0 40px 30px 40px;
    }

        /* Reposition the controls slightly */
    .carousel-control {
        left: -12px;
    }

    .carousel-control.right {
        right: -12px;
    }

        /* Changes the position of the indicators */
    .carousel-indicators {
        right: 50%;
        top: auto;
        bottom: 0px;
        margin-right: -19px;
    }

        /* Changes the colour of the indicators */
    .carousel-indicators li {
        background: #c0c0c0;
    }

    .carousel-indicators .active {
        background: #333333;
    }

    .desc {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        background: rgba(128, 0, 0, 0.4);
        width: 100%;
        height: 100%;
        color: #fff !important;
    }
</style>

<script type="text/javascript">
    $(document).ready(function () {
        $('#myCarousel').carousel({
            interval: 10000
        })

        $("[rel='tooltip']").tooltip();

        $('#item1').hover(
                function () {
                    $(this).find('.desc').slideDown(250); //.fadeIn(250)
                },
                function () {
                    $(this).find('.desc').slideUp(250); //.fadeOut(205)
                }
        );
    });
</script>

<% include common/foot.html %>
